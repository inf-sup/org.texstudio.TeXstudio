version: "1"

package:
  id: org.texstudio.TeXstudio
  name: TeXstudio
  version: 4.8.1.0
  kind: app
  description: |
    TeXstudio is an integrated writing environment for creating LaTeX documents.

base: org.deepin.foundation/23.0.0
runtime: org.deepin.Runtime/23.0.1

command:
  - /opt/apps/org.texstudio.TeXstudio/files/bin/texstudio


build: |
  # install packages
  install_pkg=$(realpath "./install_pkg.sh")
  include_pkg=''
  exclude_pkg=''
  bash $install_pkg -i -d $(realpath 'linglong/sources') -p $PREFIX -I \"$include_pkg\" -E \"$exclude_pkg\"
  export LD_LIBRARY_PATH=$PREFIX/lib/$TRIPLET:$LD_LIBRARY_PATH
  
  # build poppler
  cd /project/linglong/sources/poppler.git
  cmake -Bbuild \
        -DCMAKE_INSTALL_PREFIX=/project/linglong/sources/poppler.git/build_ins \
        -DCMAKE_INSTALL_LIBDIR=$PREFIX/lib/$TRIPLET \
        -DCMAKE_BUILD_TYPE=release
  cd build
  make -j$(nproc)
  make install
  
  # build TeXstudio
  cd /project/linglong/sources/texstudio.git
  mkdir build
  cd build
  . ../.github/scripts/get-version.sh
  cmake -DCMAKE_INSTALL_PREFIX=$PREFIX .. -Wno-dev
  . ../git_revision.sh
  cmake --build . --target install -- -j 2
  
  # uninstall dev packages
  bash $install_pkg -u -r '\-dev' -D


sources:
  # poppler
  - kind: git
    url: https://github.com/deepin-community/poppler.git
    version: master
    commit: f4af7afea9d63fa495f1c5a0ccac2edc633e15bd
  # TeXstudio
  - kind: git
    url: https://github.com/texstudio-org/texstudio.git
    version: 4.8.1
    commit: e21bf65c70c0e14548898ff0ad58b6921cec44a9
  # packages: poppler-data,libopenjp2-7-dev,libopenjp2-7,libquazip5-dev,libquazip5-1
  - kind: file
    url: https://mirrors.ustc.edu.cn/deepin/beige/pool/main/p/poppler-data/poppler-data_0.4.11-1_all.deb
    digest: b578b333ed90dc3c0e785ff3233455cf1eceb71ff602ffd30debed215ee34e2e
  - kind: file
    url: https://mirrors.ustc.edu.cn/deepin/beige/pool/main/o/openjpeg2/libopenjp2-7-dev_2.5.0-2_amd64.deb
    digest: c48717a78839cdf65f5fdcbcb8cd211f8763a782fbefc066730804904cf8d5a1
  - kind: file
    url: https://mirrors.ustc.edu.cn/deepin/beige/pool/main/o/openjpeg2/libopenjp2-7_2.5.0-2_amd64.deb
    digest: 1d7109a9c3f29c8bde7b4f92866d28860ee641dcfe3a718f4b730f845e63a4a4
  - kind: file
    url: https://mirrors.ustc.edu.cn/deepin/beige/pool/community/libq/libquazip/libquazip5-dev_0.9.1-3deepin1_amd64.deb
    digest: a6e393c5669d09d2cc201a3b56d8b87d86334b8b086dd1c2173445958f694f62
  - kind: file
    url: https://mirrors.ustc.edu.cn/deepin/beige/pool/community/libq/libquazip/libquazip5-1_0.9.1-3deepin1_amd64.deb
    digest: 7c6d352166c5ee009c8616db339cc47b3147e847c05ec28287c2602fc1b2459a
  
